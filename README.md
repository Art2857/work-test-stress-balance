# Тестовое задание для Node.js developer

## Задание 1. Создать простое webApp

Создать простое webApp, используя Node.js (Express), PostgreSQL (Sequelize ORM).

### Требования:

- При запуске приложение должно создать в базе данных таблицу **"users"** с помощью миграции
- Добавить один пользовательский аккаунт с полем **"balance"** со значением **10000**
- Использовать библиотеку **"Umzug"** для управления миграциями
- Написать route для обновления баланса пользователя (параметры: `userId` и `amount`)
- **Важно**: баланс пользователя не может быть отрицательным
- Изменение баланса должно производиться в реальном времени

### Нагрузочное тестирование:

Задание тестируется отправкой **10000 запросов** одновременно на попытку снять с баланса пользователя по **2 единицы**.

**Ожидаемый результат:**

- **5000 запросов** должны отработать успешно
- **5000 запросов** должны получить ошибку о недостаточности средств

---

## Установка

```bash
npm install
```

## Запуск

### 1. Запустите PostgreSQL

```bash
docker-compose -f docker-compose.local.yml up -d
docker-compose -f docker-compose.local.yml build --no-cache
```

### 2. Скопируйте файл окружения

```bash
cp .env.example .env
```

### 3. Запустите приложение

```bash
npm run dev
```

## Нагрузочное тестирование

```bash
npm run test:load
```

Тест отправляет **10000 одновременных запросов** на снятие по 2 единицы с баланса пользователя.

Задание 2. 


Продолжение разработки webApp.


Продолжить разработку webApp, на этот раз нашему приложению требуется обрабатывать клиентов на нескольких серверах одновременно, минимум 5 параллельных копий.
Нужно добавить в приложение cron-service, в котором будет минимум 5 тестовых фоновых задач.
Назвать каждую можно как угодно.
У каждой задачи должна быть настройка её интервала выполнения, вызываемой ею функции, имени задачи.
Каждая задача должна выполняться не менее 2 минут.
Добавить внутрь обработку данных или sleep, чтоб функция задачи завершилась не ранее, чем через 2 минуты после запуска.
Каждая задача, если её запустила какая-то из копий приложения, не должна запуститься на другой копии, пока где-либо запущена.
На одной копии приложения может быть запущено сколько угодно задач.
При одновременном старте всех копий приложения, копии должны распределить между собой задачи “+-” равномерно, т.е. не должно быть такого, чтобы одна копия просто взяла на себя все задачи.
Выполненные задачи должны записываться историей в базу данных.
Должна быть возможность в реальном времени получить по ручке список всех фоновых задач, с информацией по каждой, на каком из серверов она выполняется и какое время прошло с момента её запуска. В этом списке также должны находиться задачи, которые ожидают выполнения.
Важным моментом является то, что ни одна копия приложения не должна ничего знать о другой копии, полное отсутствие мастер-сервера.
Для реализации задачи использовать ровно те же технологии, что уже были в первой части, ничего нового использовать нельзя, только Node.js и PostgreSQL.

---

### Запуск теста:

```bash
# Мониторинг задач
npm run cron:test
```

### Эндпоинты:
- **Nginx балансировщик**: http://localhost:8080
- **API документация**: http://localhost:8080/api-docs
- **Мониторинг задач**: http://localhost:8080/api/cron/jobs

